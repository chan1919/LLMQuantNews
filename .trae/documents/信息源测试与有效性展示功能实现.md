# 信息源测试与有效性展示功能实现计划

## 一、后端部分

### 1. 创建测试文件夹结构
- 在 `backend/` 目录下创建 `tests/` 文件夹
- 在 `tests/` 下创建 `crawler/` 子文件夹，用于存放信息源测试相关的代码

### 2. 实现信息源测试功能
- 创建 `backend/tests/crawler/test_crawler_validity.py` 文件
- 实现测试信息源有效性的功能，包括：
  - 检查URL是否可访问
  - 检查RSS源是否有效
  - 测试爬虫是否能正常获取数据
  - 记录测试结果

### 3. 扩展CrawlerConfig模型
- 在 `backend/app/models.py` 中为 `CrawlerConfig` 添加状态字段：
  - `is_valid` (Boolean): 标识信息源是否有效
  - `last_test_at` (DateTime): 最后测试时间
  - `test_message` (Text): 测试结果消息

### 4. 修改后端API
- 在 `backend/app/routers/config.py` 中：
  - 添加测试信息源的端点
  - 修改获取爬虫配置的端点，返回有效性状态
  - 添加批量测试信息源的功能

### 5. 创建测试信息源配置
- 创建 `backend/scripts/test_news_sources.py` 文件
- 添加一些测试用的信息源配置，包括：
  - 有效的测试信息源
  - 无效的测试信息源（用于测试错误处理）

## 二、前端部分

### 1. 修改Config.tsx中的爬虫管理部分
- 在信息源卡片中添加有效性状态展示：
  - 使用不同颜色的状态指示器（绿色=有效，红色=无效，黄色=未知）
  - 显示最后测试时间
  - 显示测试结果消息

### 2. 添加测试功能
- 在爬虫管理页面添加：
  - 单个信息源的测试按钮
  - 批量测试所有信息源的按钮
  - 测试状态的加载动画

### 3. 优化用户体验
- 添加测试结果的通知提示
- 实现测试过程中的实时反馈
- 优化状态显示的视觉效果

## 三、测试与验证

### 1. 运行测试
- 执行信息源测试脚本，验证测试功能是否正常
- 检查数据库中信息源的状态是否正确更新

### 2. 前端验证
- 打开前端配置页面，验证信息源状态是否正确显示
- 测试开关信息源的功能
- 测试手动触发信息源测试的功能

### 3. 集成测试
- 验证整个流程是否正常工作：
  - 后端测试信息源有效性
  - 数据库更新状态
  - 前端显示状态
  - 用户可以根据状态管理信息源

## 四、文档更新

### 1. 更新README
- 添加信息源测试功能的说明
- 说明如何添加和管理测试信息源

### 2. 添加测试文档
- 创建 `backend/tests/README.md` 文件
- 说明测试功能的使用方法和注意事项

通过以上步骤，我们将实现信息源测试功能，并在前端展示信息源的有效性状态，让用户能够更直观地管理和监控信息源。